<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Teachers Logic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .teacher { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .has-slots { background: #d4edda; }
        .no-slots { background: #f8d7da; }
        button { margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Debug Teachers Logic</h1>
    
    <div class="debug-section">
        <h2>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <div id="test-data"></div>
    </div>
    
    <div class="debug-section">
        <h2>–ö–æ–Ω—Ç—Ä–æ–ª—å</h2>
        <button onclick="testWithoutFilters()">–ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏)</button>
        <button onclick="testWithSearch()">–° –ø–æ–∏—Å–∫–æ–º (–≤—Å–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã)</button>
        <button onclick="testWithSubjectFilter()">–° —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É (–≤—Å–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã)</button>
    </div>
    
    <div class="debug-section">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div id="result"></div>
    </div>

    <script>
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testTeachers = [
            { id: '1', name: '–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞', role: 'teacher', profile: { subjects: ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'], experience: 'experienced' } },
            { id: '2', name: '–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤', role: 'teacher', profile: { subjects: ['–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'], experience: 'beginner' } },
            { id: '3', name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', role: 'teacher', profile: { subjects: ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'], experience: 'professional' } },
            { id: '4', name: '–ò–≤–∞–Ω –ö–æ–∑–ª–æ–≤', role: 'teacher', profile: { subjects: ['–§–∏–∑–∏–∫–∞'], experience: 'experienced' } }
        ];

        const testSlots = [
            { id: 's1', teacherId: '1', isBooked: false, subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞' },
            { id: 's2', teacherId: '1', isBooked: true, subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞' },
            { id: 's3', teacherId: '3', isBooked: false, subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞' }
            // –£—á–∏—Ç–µ–ª—è 2 –∏ 4 –Ω–µ –∏–º–µ—é—Ç —Å–ª–æ—Ç–æ–≤
        ];

        function displayTestData() {
            const container = document.getElementById('test-data');
            container.innerHTML = `
                <h3>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ (${testTeachers.length}):</h3>
                ${testTeachers.map(t => `<div class="teacher">${t.name} (${t.profile.subjects.join(', ')})</div>`).join('')}
                
                <h3>–°–ª–æ—Ç—ã (${testSlots.length}):</h3>
                ${testSlots.map(s => `<div class="teacher ${s.isBooked ? 'no-slots' : 'has-slots'}">${s.teacherId} - ${s.subject} ${s.isBooked ? '(–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω)' : '(—Å–≤–æ–±–æ–¥–µ–Ω)'}</div>`).join('')}
            `;
        }

        function filterTeachers(hasActiveFilters, searchQuery = '', subjectFilter = '') {
            console.log('üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:');
            console.log('- hasActiveFilters:', hasActiveFilters);
            console.log('- searchQuery:', searchQuery);
            console.log('- subjectFilter:', subjectFilter);

            // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã (–Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
            const availableSlots = testSlots.filter(slot => !slot.isBooked);
            const teacherIdsWithSlots = new Set(availableSlots.map(slot => slot.teacherId));

            console.log('- availableSlots:', availableSlots.length);
            console.log('- teacherIdsWithSlots:', Array.from(teacherIdsWithSlots));

            let teachers = testTeachers;

            // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
            if (!hasActiveFilters) {
                teachers = testTeachers.filter(teacher => teacherIdsWithSlots.has(teacher.id));
                console.log('- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏:', teachers.length);
            } else {
                console.log('- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö (–µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã):', teachers.length);
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (hasActiveFilters) {
                teachers = teachers.filter(teacher => {
                    const profile = teacher.profile;

                    // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
                    if (searchQuery && !teacher.name.toLowerCase().includes(searchQuery.toLowerCase())) {
                        return false;
                    }

                    // –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
                    if (subjectFilter && (!profile.subjects || !profile.subjects.includes(subjectFilter))) {
                        return false;
                    }

                    return true;
                });
            }

            console.log('‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', teachers.length, '–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π');
            return teachers;
        }

        function testWithoutFilters() {
            const result = filterTeachers(false);
            displayResult('–ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏)', result);
        }

        function testWithSearch() {
            const result = filterTeachers(true, '–ê–Ω–Ω–∞');
            displayResult('–° –ø–æ–∏—Å–∫–æ–º "–ê–Ω–Ω–∞" (–≤—Å–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã)', result);
        }

        function testWithSubjectFilter() {
            const result = filterTeachers(true, '', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞');
            displayResult('–° —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" (–≤—Å–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã)', result);
        }

        function displayResult(title, teachers) {
            const container = document.getElementById('result');
            container.innerHTML = `
                <h3>${title}</h3>
                <p>–ù–∞–π–¥–µ–Ω–æ: ${teachers.length} –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p>
                ${teachers.map(t => `<div class="teacher">${t.name} (${t.profile.subjects.join(', ')})</div>`).join('')}
            `;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        displayTestData();
    </script>
</body>
</html>
