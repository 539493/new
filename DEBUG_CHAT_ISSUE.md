# Диагностика проблемы с чатами

## Что работает ✅
- Сервер запущен и отвечает на порту 3001
- WebSocket соединение работает
- API /api/sync возвращает данные
- Тест создания чатов проходит успешно
- События `chatCreated` отправляются и получаются

## Что НЕ работает ❌
- Репетитор не видит чаты от учеников в интерфейсе

## Возможные причины

### 1. Проблема с ID пользователей
Возможно, есть несоответствие между:
- `user.id` из AuthContext
- Реальными ID пользователей в системе
- ID участников в чатах

### 2. Проблема с фильтрацией чатов
В ChatList.tsx есть фильтрация:
```javascript
const userChats = chats.filter(chat => chat.participants.includes(user?.id || ''));
```

Если `user.id` не совпадает с ID в `chat.participants`, чат не отобразится.

### 3. Проблема с синхронизацией
Возможно, чаты создаются, но не синхронизируются между клиентами.

## Что нужно проверить

### В браузере (консоль разработчика):
1. Открыть как ученик и репетитор в разных вкладках
2. Посмотреть логи при отправке сообщения от ученика
3. Проверить логи у репетитора

### Логи которые должны появиться у репетитора:
- "chatCreated event received: {chatId}"
- "Adding new chat to state: {chatId}"  
- "ChatList: All chats: X User chats: Y User ID: {userId}"

### Если логи не появляются:
- Проблема с WebSocket соединением
- Репетитор не подключен к нужным комнатам

### Если логи есть, но чаты не отображаются:
- Проблема с фильтрацией по user.id
- Проблема с отображением в UI

## Следующие шаги

1. **Открыть приложение в браузере**
2. **Войти как ученик и репетитор**
3. **Отправить сообщение от ученика**
4. **Проверить логи в консоли репетитора**
5. **Проверить значения user.id у обеих сторон**

## Инструкция для пользователя

1. Откройте http://localhost:3000 в двух разных браузерах или вкладках
2. В первой вкладке войдите как ученик
3. Во второй вкладке войдите как репетитор
4. Откройте консоль разработчика (F12) в обеих вкладках
5. От ученика отправьте сообщение репетитору
6. Посмотрите на логи в консоли репетитора
7. Если нет логов "chatCreated event received", значит проблема с WebSocket
8. Если есть логи, но нет чата в интерфейсе, значит проблема с фильтрацией

## Если ничего не помогает
Возможно, нужно очистить localStorage и перезагрузить страницу:
```javascript
localStorage.clear();
location.reload();
```
