# Тестирование видео чата

## Проблемы, которые были исправлены:

1. **Несоответствие названий событий** - клиент использовал `video-join`, `video-offer`, а сервер ожидал `join-room`, `signal`
2. **Отсутствие правильной обработки видео событий** на сервере
3. **Проблемы с WebRTC конфигурацией** - добавлены дополнительные STUN серверы
4. **Проблемы с подключением к серверу** - исправлен URL подключения

## Как протестировать:

### 1. Через React приложение:
1. Откройте http://localhost:3002/video-test
2. Убедитесь, что статус сервера показывает "Подключено к серверу" (зеленый индикатор)
3. Введите ID комнаты (например, "test-room-123")
4. Введите ваше имя
5. Нажмите "Начать видео чат"
6. Разрешите доступ к камере и микрофону
7. Откройте ту же страницу в другом браузере/вкладке
8. Используйте тот же ID комнаты для подключения

### 2. Через простой HTML тест:
1. Откройте файл `test-webrtc.html` в браузере
2. Нажмите "Начать видео"
3. Разрешите доступ к камере и микрофону
4. Откройте тот же файл в другом браузере/вкладке
5. Нажмите "Начать видео" во втором окне

### 3. Через основное приложение:
1. Войдите в приложение как преподаватель или ученик
2. Создайте урок с форматом "online"
3. Нажмите кнопку "Видеозвонок" рядом с уроком
4. Скопируйте ссылку и отправьте другому участнику

## Что было исправлено:

### Сервер (backend/server.cjs):
- Добавлена обработка событий `video-join`, `video-offer`, `video-answer`, `video-ice-candidate`
- Улучшена логика управления комнатами
- Добавлено логирование для отладки

### Клиент (VideoChat.tsx, VideoChatPage.tsx):
- Исправлен URL подключения к серверу (порт 3001)
- Улучшена конфигурация WebRTC (дополнительные STUN серверы)
- Добавлена лучшая обработка ошибок
- Улучшена логика создания offer/answer
- Добавлено логирование состояния соединения

### Дополнительные улучшения:
- Создана тестовая страница `/video-test`
- Добавлен компонент ServerStatus для проверки подключения
- Создан простой HTML тест для быстрой проверки

## Возможные проблемы и решения:

1. **"Не удалось получить доступ к камере и микрофону"**
   - Убедитесь, что браузер имеет разрешение на доступ к камере
   - Проверьте, что камера не используется другими приложениями

2. **"Ошибка подключения к серверу"**
   - Убедитесь, что сервер запущен на порту 3001
   - Проверьте, что нет блокировки файрволом

3. **Видео не отображается**
   - Проверьте консоль браузера на ошибки
   - Убедитесь, что оба участника разрешили доступ к камере

4. **Звук не работает**
   - Проверьте настройки микрофона в браузере
   - Убедитесь, что микрофон не заблокирован

## Команды для запуска:

```bash
# Запуск сервера
cd backend && node server.cjs

# Запуск клиента (в другом терминале)
npm run dev
```

## Полезные URL для тестирования:

- http://localhost:3002/video-test - тестовая страница
- http://localhost:3002/video-chat?lesson=test&user=User&role=student - прямая ссылка на видео чат
- http://localhost:3001 - статус сервера (JSON) 