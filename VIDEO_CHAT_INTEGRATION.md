# Интеграция видео чата

## Обзор изменений

Видео чат был успешно интегрирован в основное приложение вместо использования внешнего сервиса `https://video-chat-web-lp8d.onrender.com`. Теперь видео чат открывается на отдельной странице с современным дизайном и системой уникальных ссылок для каждого урока.

## Основные изменения

### 1. Серверная часть (`backend/production-server-simple.cjs`)

- Добавлена поддержка WebRTC через Socket.IO
- Интегрирована функциональность видео чата в основной сервер
- Добавлены обработчики для:
  - `video-join` - присоединение к видео комнате
  - `video-offer` - WebRTC offer
  - `video-answer` - WebRTC answer  
  - `video-ice-candidate` - ICE кандидаты
  - `video-user-joined` - уведомление о новом пользователе
  - `video-user-left` - уведомление о выходе пользователя

### 2. Новая страница видео чата (`src/components/Shared/VideoChatPage.tsx`)

- Создана отдельная страница для видео чата
- Современный темный дизайн как в оригинальном приложении
- Полноэкранный интерфейс с локальным видео в правом верхнем углу
- Панель управления внизу экрана
- Автоматическое получение параметров из URL
- **Система уникальных ссылок** для каждого урока
- **Кнопки копирования и обмена ссылками**

### 3. Компонент ссылок на видео чат (`src/components/Shared/VideoChatLink.tsx`)

- Создан универсальный компонент для генерации ссылок
- Поддержка копирования ссылок в буфер обмена
- Модальное окно для обмена ссылками
- Автоматическое определение роли (студент/преподаватель)

### 4. Обновление маршрутизации (`src/App.tsx`)

- Добавлен маршрут `/video-chat` для новой страницы
- Поддержка параметров `lesson`, `user` и `role` в URL

### 5. Обновление компонентов студентов и преподавателей

#### `src/components/Student/StudentLessons.tsx`
- Заменена модальная форма на открытие новой страницы
- Удалены ненужные состояния и компоненты
- **Добавлен компонент VideoChatLink** для удобного управления ссылками

#### `src/components/Teacher/TeacherSlots.tsx`
- Заменены модальные формы на открытие новой страницы
- Удалены ненужные состояния и компоненты
- **Добавлен компонент VideoChatLink** для удобного управления ссылками

### 6. Удаленные файлы

- `backend/video-chat-server.js` - удален, функциональность интегрирована в основной сервер

## Система уникальных ссылок

### URL структура

Каждый урок получает уникальную ссылку:
```
/video-chat?lesson={lessonId}&user={userName}&role={role}
```

Где:
- `lessonId` - уникальный идентификатор урока
- `userName` - имя пользователя для отображения
- `role` - роль пользователя (`student` или `teacher`)

### Примеры ссылок

**Для студента:**
```
http://localhost:3000/video-chat?lesson=lesson_123&user=Иван&role=student
```

**Для преподавателя:**
```
http://localhost:3000/video-chat?lesson=lesson_123&user=Мария&role=teacher
```

### Функциональность ссылок

1. **Автоматическое подключение** - при переходе по ссылке пользователь автоматически подключается к комнате урока
2. **Копирование ссылки** - кнопка для копирования ссылки в буфер обмена
3. **Обмен ссылками** - модальное окно для удобного обмена ссылками
4. **Уникальность** - каждая ссылка уникальна для конкретного урока

## Преимущества новой интеграции

1. **Уникальные ссылки** - каждый урок имеет свою уникальную ссылку
2. **Отдельная страница** - видео чат открывается на новой вкладке/странице
3. **Современный дизайн** - темная тема с профессиональным интерфейсом
4. **Локальная работа** - видео чат работает на том же сервере
5. **Единая аутентификация** - пользователи уже авторизованы в системе
6. **Лучшая производительность** - нет дополнительных сетевых запросов к внешнему сервису
7. **Полный контроль** - можно настраивать и улучшать функциональность
8. **Безопасность** - данные не передаются на внешние сервисы
9. **Удобство обмена** - встроенные функции копирования и обмена ссылками

## Использование

### Для студентов:
1. Перейдите в раздел "Мои уроки"
2. Найдите запланированный онлайн урок
3. Нажмите кнопку "Видеозвонок" или "Копировать ссылку"
4. Откроется новая страница с видео чатом
5. Разрешите доступ к камере и микрофону
6. Поделитесь ссылкой с преподавателем

### Для преподавателей:
1. Перейдите в раздел "Мои слоты"
2. Найдите забронированный онлайн слот или урок
3. Нажмите кнопку "Видеозвонок" или "Копировать ссылку"
4. Откроется новая страница с видео чатом
5. Разрешите доступ к камере и микрофону
6. Поделитесь ссылкой с учеником

## Дизайн интерфейса

- **Темная тема** - серый фон для лучшего восприятия видео
- **Локальное видео** - в правом верхнем углу с подписью "Вы (Имя)"
- **Основное видео** - занимает весь экран для удаленного участника
- **Панель управления** - внизу экрана с кнопками управления
- **Индикаторы состояния** - показывают подключение, микрофон, камеру
- **Кнопки обмена** - для копирования и обмена ссылками

## Технические детали

- **WebRTC**: Используется для peer-to-peer видеосвязи
- **Socket.IO**: Для сигналинга и управления комнатами
- **STUN серверы**: Google STUN серверы для NAT traversal
- **Поддерживаемые браузеры**: Все современные браузеры с поддержкой WebRTC
- **URL параметры**: Автоматическое получение lesson, user и role из URL
- **Уникальные комнаты**: Каждый урок имеет свою уникальную комнату

## Запуск

```bash
# Установка зависимостей
npm install

# Сборка проекта
npm run build

# Запуск сервера
npm start
```

Сервер будет доступен по адресу `http://localhost:3000`

## Пример использования

1. **Студент** нажимает "Видеозвонок" на уроке
2. Открывается новая вкладка: `http://localhost:3000/video-chat?lesson=lesson_123&user=Иван&role=student`
3. **Преподаватель** нажимает "Видеозвонок" на том же уроке
4. Открывается новая вкладка: `http://localhost:3000/video-chat?lesson=lesson_123&user=Мария&role=teacher`
5. Оба участника подключаются к одной комнате и могут видеть друг друга
6. **Обмен ссылками** - любой участник может скопировать и поделиться ссылкой

## Компоненты

### VideoChatPage
- Основная страница видео чата
- Полноэкранный интерфейс
- Автоматическое подключение к комнате
- Управление микрофоном и камерой

### VideoChatLink
- Компонент для генерации ссылок
- Кнопки копирования и обмена
- Модальное окно с ссылкой
- Поддержка разных ролей 