# Интеграция видео чата

## Обзор изменений

Видео чат был успешно интегрирован в основное приложение вместо использования внешнего сервиса `https://video-chat-web-lp8d.onrender.com`. Теперь видео чат открывается на отдельной странице с современным дизайном.

## Основные изменения

### 1. Серверная часть (`backend/production-server-simple.cjs`)

- Добавлена поддержка WebRTC через Socket.IO
- Интегрирована функциональность видео чата в основной сервер
- Добавлены обработчики для:
  - `video-join` - присоединение к видео комнате
  - `video-offer` - WebRTC offer
  - `video-answer` - WebRTC answer  
  - `video-ice-candidate` - ICE кандидаты
  - `video-user-joined` - уведомление о новом пользователе
  - `video-user-left` - уведомление о выходе пользователя

### 2. Новая страница видео чата (`src/components/Shared/VideoChatPage.tsx`)

- Создана отдельная страница для видео чата
- Современный темный дизайн как в оригинальном приложении
- Полноэкранный интерфейс с локальным видео в правом верхнем углу
- Панель управления внизу экрана
- Автоматическое получение параметров из URL

### 3. Обновление маршрутизации (`src/App.tsx`)

- Добавлен маршрут `/video-chat` для новой страницы
- Поддержка параметров `room` и `user` в URL

### 4. Обновление компонентов студентов и преподавателей

#### `src/components/Student/StudentLessons.tsx`
- Заменена модальная форма на открытие новой страницы
- Удалены ненужные состояния и компоненты

#### `src/components/Teacher/TeacherSlots.tsx`
- Заменены модальные формы на открытие новой страницы
- Удалены ненужные состояния и компоненты

### 5. Удаленные файлы

- `backend/video-chat-server.js` - удален, функциональность интегрирована в основной сервер

## Преимущества новой интеграции

1. **Отдельная страница** - видео чат открывается на новой вкладке/странице
2. **Современный дизайн** - темная тема с профессиональным интерфейсом
3. **Локальная работа** - видео чат работает на том же сервере
4. **Единая аутентификация** - пользователи уже авторизованы в системе
5. **Лучшая производительность** - нет дополнительных сетевых запросов к внешнему сервису
6. **Полный контроль** - можно настраивать и улучшать функциональность
7. **Безопасность** - данные не передаются на внешние сервисы

## Использование

### Для студентов:
1. Перейдите в раздел "Мои уроки"
2. Найдите запланированный онлайн урок
3. Нажмите кнопку "Видеозвонок"
4. Откроется новая страница с видео чатом
5. Разрешите доступ к камере и микрофону

### Для преподавателей:
1. Перейдите в раздел "Мои слоты"
2. Найдите забронированный онлайн слот или урок
3. Нажмите кнопку "Видеозвонок"
4. Откроется новая страница с видео чатом
5. Разрешите доступ к камере и микрофону

## URL структура

Видео чат доступен по адресу:
```
/video-chat?room={roomId}&user={userName}
```

Где:
- `roomId` - уникальный идентификатор комнаты (обычно `lesson_{lessonId}`)
- `userName` - имя пользователя для отображения

## Дизайн интерфейса

- **Темная тема** - серый фон для лучшего восприятия видео
- **Локальное видео** - в правом верхнем углу с подписью "Вы (Имя)"
- **Основное видео** - занимает весь экран для удаленного участника
- **Панель управления** - внизу экрана с кнопками управления
- **Индикаторы состояния** - показывают подключение, микрофон, камеру

## Технические детали

- **WebRTC**: Используется для peer-to-peer видеосвязи
- **Socket.IO**: Для сигналинга и управления комнатами
- **STUN серверы**: Google STUN серверы для NAT traversal
- **Поддерживаемые браузеры**: Все современные браузеры с поддержкой WebRTC
- **URL параметры**: Автоматическое получение room и user из URL

## Запуск

```bash
# Установка зависимостей
npm install

# Сборка проекта
npm run build

# Запуск сервера
npm start
```

Сервер будет доступен по адресу `http://localhost:3000`

## Пример использования

1. Студент нажимает "Видеозвонок" на уроке
2. Открывается новая вкладка: `http://localhost:3000/video-chat?room=lesson_123&user=Иван`
3. Преподаватель нажимает "Видеозвонок" на том же уроке
4. Открывается новая вкладка: `http://localhost:3000/video-chat?room=lesson_123&user=Мария`
5. Оба участника подключаются к одной комнате и могут видеть друг друга 